# 突破前高策略 - 手动操作指南

## 策略概述

突破前高策略是一个趋势跟踪策略，核心思想是：**当价格突破近期高点并伴随放量时买入，当趋势转弱时卖出**。

---

## 一、建仓触发点（买入信号）

### 触发条件（需同时满足）

#### 1. **突破前高**（核心条件）
- **定义**：当日收盘价 > 最近20天（默认）的最高价
- **计算方法**：
  - 查看最近20个交易日的最高价
  - 如果今日收盘价超过这个最高价，满足条件
- **含义**：价格创出近期新高，可能开启上涨趋势

#### 2. **趋势过滤**（可选，默认启用）
- **定义**：当日收盘价 > 20日均线
- **计算方法**：计算20日移动平均线，收盘价需在其上方
- **含义**：确认处于上涨趋势中，避免在下跌趋势中买入
- **注意**：可通过参数 `--trend-ma 0` 关闭此过滤

#### 3. **量能过滤**（可选，默认启用）
- **定义**：当日成交量 > 最近10天平均成交量的1.0倍（默认）
- **计算方法**：
  - 计算最近10天的平均成交量
  - 当日成交量需大于等于平均值
- **含义**：放量突破更可靠，避免假突破
- **注意**：可通过参数 `--vol-mult 0` 关闭此过滤

### 实际操作步骤

1. **每日收盘后检查**：
   - 计算最近20天的最高价
   - 计算20日均线
   - 计算最近10天的平均成交量

2. **判断是否满足条件**：
   ```
   收盘价 > 20天最高价  AND
   收盘价 > 20日均线    AND
   成交量 >= 10日均量
   ```

3. **如果满足，次日开盘买入**：
   - 建议在开盘后15-30分钟内买入（避免开盘价异常）
   - 可以设置限价单，以昨日收盘价或略高价格买入
   - 全仓买入（策略默认全仓）

---

## 二、清仓触发点（卖出信号）

### 触发条件（满足任一即可卖出）

#### 1. **破前有效低点**（主要清仓信号）
- **定义**：当日最低价 < 上一根有效K线的最低价
- **有效K线规则**（内外包线过滤）：
  - 如果当日K线被前一有效K线完全包含（高点≤前高，低点≥前低），则忽略当日K线
  - 如果当日K线完全包住前一有效K线（高点≥前高，低点≤前低），则忽略前一有效K线
  - 只有"有效K线"才参与比较
- **含义**：趋势转弱，可能开始下跌
- **实际操作**：
  - 记录持仓后的所有有效K线
  - 每日收盘后检查：当日最低价是否跌破上一有效K线最低价
  - 如果跌破，次日开盘卖出

#### 2. **移动止损**（可选，默认启用）
有两种方式可选：

**方式A：简化移动止损（推荐，手动操作更简单）**
- **定义**：收盘价 < 最高价 × (1 - 止损百分比)
- **计算方法**：
  - 移动止损价 = 持仓期间最高价 × (1 - 止损百分比/100)
  - 例如：止损百分比=5%，最高价=16.00元，则移动止损价 = 16.00 × 0.95 = 15.20元
  - 如果收盘价跌破移动止损价，触发止损
- **含义**：固定百分比回撤止损，简单易算
- **实际操作**：
  - 持仓后记录最高价
  - 每日更新最高价（如果今日收盘价更高）
  - 每日计算：移动止损价 = 当前最高价 × (1 - 止损百分比)
  - 如果收盘价 < 移动止损价，次日开盘卖出
- **参数设置**：`--simple-stop-pct 5` 表示5%回撤止损
- **优势**：计算简单，不需要计算ATR，适合手动操作

**方式B：ATR移动止损（更精确，但计算复杂）**
- **定义**：收盘价 < 最高价 - ATR × 2.0（默认倍数）
- **计算方法**：
  - ATR（平均真实波幅）= 14日平均真实波幅
  - 真实波幅 = max(当日最高-最低, |当日最高-昨收|, |当日最低-昨收|)
  - 移动止损价 = 持仓期间最高价 - ATR × 2.0
  - 如果收盘价跌破移动止损价，触发止损
- **含义**：动态止损，根据市场波动调整
- **实际操作**：
  - 持仓后记录最高价
  - 每日计算ATR（14日平均真实波幅）
  - 每日计算：移动止损价 = 最高价 - ATR × 2.0
  - 如果收盘价 < 移动止损价，次日开盘卖出
- **参数设置**：`--atr-mult 2.0` 表示ATR倍数，设为9999关闭
- **注意**：如果设置了 `--simple-stop-pct`，则忽略ATR止损

#### 3. **时间止损**（可选，默认关闭）
- **定义**：持仓超过N天（默认不限制）
- **含义**：避免长期持仓占用资金
- **实际操作**：
  - 记录买入日期
  - 如果持仓天数 >= 设定天数，强制卖出
- **注意**：可通过参数 `--max-hold-days N` 设置

### 实际操作步骤

1. **每日收盘后检查三个清仓条件**：
   - 检查是否破前有效低点
   - 检查是否触发ATR移动止损
   - 检查是否超过最长持仓天数

2. **如果满足任一条件，次日开盘卖出**：
   - 建议在开盘后15-30分钟内卖出
   - 可以设置限价单，以昨日收盘价或略低价格卖出
   - 全部卖出（策略默认全仓）

---

## 三、操作建议

### 1. 准备工作

**每日需要计算的数据**：
- 最近20天的最高价
- 20日均线
- 最近10天的平均成交量
- 有效K线序列（持仓后需要跟踪）
- **如果使用简化移动止损**：只需记录持仓期间最高价，无需计算ATR
- **如果使用ATR移动止损**：需要计算ATR（14日平均真实波幅）

**工具推荐**：
- 使用Excel或Python脚本自动计算
- 使用交易软件的技术指标功能
- 使用量化平台（如聚宽、米筐）的指标函数

### 2. 买入操作建议

**时机选择**：
- ✅ **推荐**：收盘确认信号后，次日开盘买入
- ✅ **备选**：如果盘中已经突破前高且放量，可以尾盘买入
- ❌ **避免**：开盘集合竞价买入（价格可能异常）

**价格设置**：
- 限价单：以昨日收盘价或略高（+0.5%）买入
- 市价单：开盘后15-30分钟买入，避免开盘波动

**仓位管理**：
- 策略默认全仓，但建议：
  - 单只股票不超过总资金的30%
  - 同时持仓不超过3-5只股票
  - 保留10-20%现金作为缓冲

### 3. 卖出操作建议

**时机选择**：
- ✅ **推荐**：收盘确认信号后，次日开盘卖出
- ✅ **紧急**：如果盘中已经触发止损，可以立即卖出
- ❌ **避免**：开盘集合竞价卖出（价格可能异常）

**价格设置**：
- 限价单：以昨日收盘价或略低（-0.5%）卖出
- 市价单：开盘后15-30分钟卖出

**止损纪律**：
- **严格执行**：一旦触发止损，必须卖出，不要犹豫
- **不要补仓**：卖出后不要立即买入，等待新的买入信号
- **记录原因**：记录每次卖出的原因（破前低/ATR止损/时间止损）

### 4. 风险控制建议

**资金管理**：
- 单笔交易最大亏损不超过总资金的2%
- 总持仓风险不超过总资金的10%
- 保留应急资金

**市场环境**：
- 大盘处于下跌趋势时，减少操作或暂停
- 市场波动过大时，提高止损标准
- 重大事件（如财报、政策）前后谨慎操作

**心理控制**：
- 严格执行信号，不要主观判断
- 不要因为亏损而改变策略
- 保持耐心，等待信号出现

### 5. 参数调整建议

**保守型**（降低交易频率，提高信号质量）：
```bash
--high-lookback 30    # 前高回看30天（更长周期）
--trend-ma 30         # 趋势过滤用30日均线
--vol-mult 1.5        # 要求成交量大于均量1.5倍
--simple-stop-pct 6   # 简化止损6%回撤（更宽止损）
# 或使用ATR：--atr-mult 2.5
```

**激进型**（增加交易频率，捕捉更多机会）：
```bash
--high-lookback 10    # 前高回看10天（更短周期）
--trend-ma 0          # 关闭趋势过滤
--vol-mult 0          # 关闭量能过滤
--simple-stop-pct 3   # 简化止损3%回撤（更紧止损）
# 或使用ATR：--atr-mult 1.5
```

**平衡型**（默认参数）：
```bash
--high-lookback 20    # 前高回看20天
--trend-ma 20         # 趋势过滤用20日均线
--vol-mult 1.0        # 要求成交量大于等于均量
--simple-stop-pct 5   # 简化止损5%回撤（推荐手动操作）
# 或使用ATR：--atr-mult 2.0
```

**手动操作推荐**：使用 `--simple-stop-pct` 参数，计算更简单，只需记录最高价并乘以 (1 - 止损百分比) 即可。

---

## 四、实际操作示例

### 示例：某股票建仓过程

**第1步：计算指标（每日收盘后）**
- 最近20天最高价：15.50元
- 20日均线：14.80元
- 最近10天平均成交量：1000万股
- 今日收盘价：15.60元
- 今日成交量：1200万股

**第2步：判断买入条件**
- ✅ 收盘价15.60 > 20天最高价15.50（突破前高）
- ✅ 收盘价15.60 > 20日均线14.80（趋势向上）
- ✅ 成交量1200万 > 均量1000万（放量）

**第3步：执行买入**
- 次日开盘后，以15.60-15.70元价格买入
- 记录买入价格：15.60元
- 记录买入日期：2024-11-25

### 示例：持仓期间的止损检查（简化版，5%回撤）

**持仓后第5天：**
- 持仓期间最高价：16.20元
- 移动止损价 = 16.20 × 0.95 = 15.39元
- 今日收盘价：15.80元
- ✅ 收盘价 > 移动止损价，继续持有

**持仓后第8天：**
- 持仓期间最高价：16.50元（更新，今日收盘价更高）
- 移动止损价 = 16.50 × 0.95 = 15.68元（随最高价上移）
- 今日收盘价：15.60元
- ❌ 收盘价 < 移动止损价，触发止损
- 次日开盘卖出

**说明**：简化版只需要记录最高价，然后用最高价乘以0.95即可，非常方便手动计算。

### 示例：持仓期间的止损检查（ATR版）

**持仓后第5天：**
- 持仓期间最高价：16.20元
- ATR = 0.30元
- 移动止损价 = 16.20 - 0.30 × 2.0 = 15.60元
- 今日收盘价：15.80元
- ✅ 收盘价 > 移动止损价，继续持有

**持仓后第8天：**
- 持仓期间最高价：16.50元（更新）
- ATR = 0.32元
- 移动止损价 = 16.50 - 0.32 × 2.0 = 15.86元
- 今日收盘价：15.70元
- ❌ 收盘价 < 移动止损价，触发止损
- 次日开盘卖出

---

## 五、常见问题

### Q1: 如果盘中突破前高，可以买入吗？
**A**: 可以，但建议等收盘确认。如果收盘价确实突破前高且放量，可以尾盘买入或次日买入。

### Q2: 如果买入后立即回调，怎么办？
**A**: 严格执行止损。如果触发破前低或ATR止损，必须卖出。不要因为"刚买入"而犹豫。

### Q3: 如何判断"有效K线"？
**A**: 需要跟踪K线的包含关系：
- 被包含的K线忽略
- 包住前一根的K线，前一根被移除
- 只有独立有效的K线才参与低点比较

### Q4: 参数如何调整？
**A**: 建议先用默认参数回测，根据回测结果调整：
- 如果信号太少，降低 `--high-lookback` 或关闭过滤
- 如果亏损太多，提高 `--atr-mult` 或增加 `--trend-ma`
- 如果交易太频繁，提高 `--vol-mult` 或增加 `--high-lookback`

### Q5: 可以同时操作多只股票吗？
**A**: 可以，但建议：
- 同时持仓不超过3-5只
- 单只股票不超过总资金30%
- 使用相同的参数设置，保持一致性

---

## 六、总结

**核心要点**：
1. **买入**：收盘价突破20天最高价 + 在20日均线上方 + 放量
2. **卖出**：破前有效低点 OR 移动止损（简化版/ATR版） OR 时间止损
3. **移动止损推荐**：使用简化版（`--simple-stop-pct`），只需记录最高价，计算更简单
4. **纪律**：严格执行信号，不要主观判断
5. **风控**：单只股票不超过30%，总持仓不超过80%

**成功关键**：
- ✅ 严格执行信号
- ✅ 做好资金管理
- ✅ 保持耐心等待
- ✅ 记录每次交易

**风险提示**：
- 任何策略都有失效的可能
- 建议先用小资金测试
- 根据实际情况调整参数
- 不要把所有资金投入单一策略

