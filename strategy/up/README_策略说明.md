# 中国平安量化策略回测系统

## 策略说明

这是一个基于K线包含处理的量化交易策略，专门针对中国平安（601318）股票设计。

### 策略规则

1. **买入信号**：当当前有效K线的高点突破前一根有效K线的高点时，买入并持有
2. **卖出信号**：当持仓时，如果当前有效K线的低点跌破前一根有效K线的低点时，卖出清仓
3. **K线包含处理**：
   - 如果当前K线被前一根K线包含（高点≤前高且低点≥前低），忽略当前K线
   - 如果当前K线包含前一根K线（高点≥前高且低点≤前低），忽略前一根K线
   - 被忽略的K线在后续判断中不再考虑

### 文件说明

- `quant_strategy.py` - 基础版本，包含详细输出
- `quant_strategy_enhanced.py` - 增强版本，优化了数据获取和输出
- `requirements.txt` - 依赖包列表
- `trading_results.csv` - 回测结果（运行后生成）

## 安装依赖

```bash
pip install pandas numpy akshare
```

或者使用requirements.txt：

```bash
pip install -r requirements.txt
```

## 使用方法

### 基础版本

```bash
python3 quant_strategy.py
```

### 增强版本（推荐）

```bash
python3 quant_strategy_enhanced.py
```

## 输出说明

### 回测结果包含：

1. **基本信息**
   - 回测期间
   - 总交易日数
   - 有效K线数（经过包含处理后的K线）
   - 忽略K线数

2. **交易统计**
   - 总交易次数
   - 盈利次数
   - 亏损次数
   - 胜率
   - 总收益率
   - 平均收益率
   - 最大单笔盈利
   - 最大单笔亏损

3. **交易明细**
   - 每笔交易的买入/卖出日期和价格
   - 收益率
   - 交易原因

4. **CSV文件**
   - 所有交易记录保存到 `trading_results.csv`

## 数据获取

策略会尝试从网络获取中国平安（601318）的真实历史数据。如果获取失败，会自动使用模拟数据进行演示。

### 使用真实数据

确保网络连接正常，akshare库会自动尝试获取数据。

### 使用模拟数据

如果网络获取失败，程序会自动生成模拟数据进行策略验证。

## 策略特点

1. **K线包含处理**：有效过滤掉被包含的K线，只关注关键的价格突破点
2. **趋势跟踪**：高点突破买入，低点跌破卖出，适合趋势行情
3. **风险控制**：跌破前低立即止损，控制单笔亏损

## 注意事项

1. 本策略仅用于回测验证，不构成投资建议
2. 实际交易需要考虑手续费、滑点等因素
3. 策略在震荡市场中可能产生较多亏损
4. 建议结合其他技术指标和基本面分析

## 示例输出

```
回测结果统计
============================================================
回测期间: 2023-01-02 至 2023-12-19
总交易日: 252 天
有效K线数: 170 根
忽略K线数: 82 根

交易统计:
  总交易次数: 11 次
  盈利次数: 5 次
  亏损次数: 6 次
  胜率: 45.45%
  总收益率: 218.30%
  平均收益率: 19.85%
  最大单笔盈利: 75.18%
  最大单笔亏损: -9.55%
```

## 后续优化建议

1. 添加止损止盈机制
2. 结合成交量分析
3. 添加移动平均线等指标过滤
4. 优化包含处理逻辑
5. 添加回撤分析
6. 添加可视化图表

