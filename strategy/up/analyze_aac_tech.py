#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
分析瑞声科技是否适合该量化策略
"""

import pandas as pd
import numpy as np

# 瑞声科技的回测数据
AAC_TECH_RESULTS = {
    '股票名称': '瑞声科技',
    '股票代码': '02018',
    '过去两年数据': {
        '总收益率': -558.51,
        '胜率': 17.72,
        '交易次数': 158,
        '盈利次数': 28,
        '亏损次数': 130,
        '平均收益率': -3.53,
        '最大盈利': 25.00,
        '最大亏损': -18.29,
        '有效K线': 668,
        '忽略K线': 298
    }
}

def analyze_aac_tech():
    """分析瑞声科技的特征"""
    print("="*80)
    print("瑞声科技策略适配性分析")
    print("="*80)
    
    print("\n【1. 回测表现分析】")
    print("-"*60)
    data = AAC_TECH_RESULTS['过去两年数据']
    print(f"过去两年总收益率: {data['总收益率']:.2f}%")
    print(f"胜率: {data['胜率']:.2f}%")
    print(f"交易次数: {data['交易次数']} 次（非常高）")
    print(f"盈利次数: {data['盈利次数']} 次")
    print(f"亏损次数: {data['亏损次数']} 次")
    print(f"平均收益率: {data['平均收益率']:.2f}%")
    print(f"最大单笔盈利: {data['最大盈利']:.2f}%")
    print(f"最大单笔亏损: {data['最大亏损']:.2f}%")
    
    print("\n【关键问题】")
    print("❌ 总收益率极差：-558.51%（严重亏损）")
    print("❌ 胜率很低：17.72%（低于20%）")
    print("❌ 交易频率极高：158次（说明频繁震荡）")
    print("❌ 亏损次数远多于盈利次数：130 vs 28")
    print("❌ 平均收益率负值：-3.53%")
    
    print("\n【2. 股票特征分析】")
    print("-"*60)
    print("公司信息：")
    print("  - 行业：消费电子/声学器件（科技硬件）")
    print("  - 业务：手机声学器件、触控马达、光学器件")
    print("  - 特点：周期性较强，受手机行业影响大")
    
    print("\n技术特征推断（基于回测数据）：")
    print("  - 交易次数158次（最高）→ 说明波动频繁，震荡明显")
    print("  - 有效K线668根，忽略K线298根 → K线包含关系多，波动复杂")
    print("  - 最大盈利25%，最大亏损-18.29% → 波动幅度中等")
    print("  - 胜率17.72% → 假突破多，趋势不明显")
    
    print("\n【3. 与选股标准对比】")
    print("-"*60)
    
    print("\n✓ 符合的标准：")
    print("  ✓ 行业：科技硬件（成长性行业）")
    print("  ✓ 流动性：应该较好（港股通标的）")
    print("  ✓ 市值：中大型（符合50-500亿标准）")
    
    print("\n❌ 不符合的标准：")
    print("  ❌ 趋势性：交易次数158次说明震荡明显，缺乏明显趋势")
    print("  ❌ 波动性：可能波动过大或过于频繁，导致假突破多")
    print("  ❌ 技术形态：从回测看，横盘整理特征明显")
    print("  ❌ 市场环境：过去两年可能处于震荡或下跌趋势")
    
    print("\n【4. 不适合的原因分析】")
    print("-"*60)
    print("1. 震荡市场特征明显")
    print("   - 交易次数158次（8只股票中最高）")
    print("   - 说明价格频繁突破又回落，假突破多")
    print("   - 策略在震荡市场中表现最差")
    
    print("\n2. 趋势性不足")
    print("   - 胜率仅17.72%，说明突破后往往失败")
    print("   - 亏损次数130次远多于盈利次数28次")
    print("   - 缺乏持续的趋势性行情")
    
    print("\n3. 波动模式不适合")
    print("   - K线包含关系多（298根被忽略）")
    print("   - 说明价格波动复杂，难以形成有效突破")
    print("   - 平均收益率-3.53%，每次交易都在亏损")
    
    print("\n4. 行业周期性影响")
    print("   - 消费电子行业受手机销量影响大")
    print("   - 过去两年手机行业可能处于调整期")
    print("   - 导致股价缺乏明确趋势")
    
    print("\n【5. 结论与建议】")
    print("="*80)
    print("\n❌ 瑞声科技不适合该策略")
    print("\n原因：")
    print("1. 回测表现极差：-558.51%的总收益率")
    print("2. 震荡特征明显：158次交易说明缺乏趋势")
    print("3. 胜率过低：17.72%，假突破多")
    print("4. 亏损累积：平均每次交易亏损3.53%")
    
    print("\n【改进建议】")
    print("-"*60)
    print("如果一定要使用该策略交易瑞声科技，需要：")
    print("\n1. 添加趋势过滤：")
    print("   - 只在20日均线明显向上时交易")
    print("   - 只在价格突破关键阻力位时交易")
    print("   - 避免在横盘整理期交易")
    
    print("\n2. 添加成交量确认：")
    print("   - 突破时必须有成交量放大")
    print("   - 避免低成交量突破（可能是假突破）")
    
    print("\n3. 优化止损机制：")
    print("   - 使用更严格的止损（如-3%）")
    print("   - 避免频繁的小额亏损累积")
    
    print("\n4. 等待更好的市场环境：")
    print("   - 等待手机行业复苏")
    print("   - 等待股价形成明显上升趋势")
    print("   - 避免在震荡期使用策略")
    
    print("\n5. 考虑其他策略：")
    print("   - 震荡策略（高抛低吸）")
    print("   - 均值回归策略")
    print("   - 或等待趋势明确后再使用突破策略")
    
    print("\n" + "="*80)
    print("总结：瑞声科技不适合该趋势跟踪策略")
    print("建议：选择趋势更明显的股票，或等待瑞声科技形成明确上升趋势后再考虑")
    print("="*80)


def compare_with_other_stocks():
    """与其他股票对比"""
    print("\n" + "="*80)
    print("与其他股票对比")
    print("="*80)
    
    stocks_comparison = {
        '国泰君安国际': {'return': -86.39, 'trades': 84, 'win_rate': 14.29, 'rank': 1},
        '中国光大控股': {'return': -213.95, 'trades': 126, 'win_rate': 18.25, 'rank': 2},
        '小米集团': {'return': -371.96, 'trades': 154, 'win_rate': 24.03, 'rank': 3},
        '众安在线': {'return': -407.16, 'trades': 136, 'win_rate': 15.44, 'rank': 4},
        '德林控股': {'return': -417.26, 'trades': 114, 'win_rate': 10.53, 'rank': 5},
        '瑞声科技': {'return': -558.51, 'trades': 158, 'win_rate': 17.72, 'rank': 6},
        '李宁': {'return': -594.48, 'trades': 154, 'win_rate': 15.58, 'rank': 7},
        '趣志集团': {'return': -615.70, 'trades': 124, 'win_rate': 16.13, 'rank': 8}
    }
    
    print("\n收益率排名（从好到差）：")
    for stock, data in sorted(stocks_comparison.items(), key=lambda x: x[1]['return']):
        marker = "❌" if stock == '瑞声科技' else "  "
        print(f"{marker} {data['rank']}. {stock}: {data['return']:.2f}%, "
              f"交易次数 {data['trades']}, 胜率 {data['win_rate']:.2f}%")
    
    print("\n关键发现：")
    print("  - 瑞声科技在8只股票中排名第6（倒数第3）")
    print("  - 交易次数158次（最高），说明震荡最明显")
    print("  - 收益率-558.51%，表现极差")
    print("  - 胜率17.72%，虽然不是最低，但结合高交易频率，亏损累积严重")


if __name__ == '__main__':
    analyze_aac_tech()
    compare_with_other_stocks()

